---
layout: page
title: "Data"
category: start
date: 2016-05-20 12:11:58
order: 2
---

## Use Alambic

You can use Alambic by simply adding the following statement to your PHP scripts.

~~~php
<?php
use Alambic\Alambic;
~~~

## Create a basic Model

The Alambic configuration describes:

* the data structure: *Types*
* how data can be fetched: *Connectors*

### Setup connectors list

For this simple example, we will just use one of the built-in connectors: the *json* connector, which map your types to json files.
One key strength of Alambic is that a single API endpoint can handle multiple connectors.

~~~php
<?php
$connectors" => [
  "mySimpleDB" => [
    "connectorClass" => "Alambic\\Connector\\json"
  ]
];
~~~

### Setup types

*Types* describe the objects than can be requested, and the relations between theses objects

We'll first configure the Users model:

~~~php
<?php
$userModel = [
  // Use a unique model name
  "name" => "userModel",
  // Whatever model description you want
  "description" => "Users",
  // Fields list
  "fields" => [
    // The 'id' field
    "id" => [
      "type" => "String",
      "required" => true,
      "description" => "User Id"
    ],
    // The 'name' field
    "name" => [
      "type" => "String",
      "description" => "User Name"
    ]
  ],
  // Can we query this model directly?
  "expose" => true,
  // The single endpoint allows to request for one user at a time
  "singleEndpoint" => [
    "name" => "user",
    // This endpoint only takes a user Id as an argument
    "args" => [
      "id" => [
        "type" => "String",
        "required" => true,
        "description" => "User Id"
      ]
    ]
  ],
  // The connector used to fetch/write the data
  "connector" => [
    "type" => "mySimpleDB",
      "configs" => [
        "file" => "users.json"
      ]
    ]
  ]
~~~

The Post model is pretty similar to the User one, excepts that it references the link between a Post and its Author:

~~~php
<?php
$postModel = [
  "name" => "postModel",
  "description" => "Posts",
  "fields" => [
    "id" => [
      "type" => "String",
      "required" => true,
      "description" => "Post Id"
    ],
    "text" => [
      "type" => "String",
      "description" => "Post Text"
    ],
    // The author is a User type
    "author" => [
      "type" => "User",
      // The relation can be hasOne or hasMany
      "multivalued" => false,
      // We can query the name of the author
      "args" => [
        "name" => [
          "type": "String"
        ]
      ],
      // The foreign key is the user id
      "relation" => [
        "id" => "author"
      ]
    },
  ],
  "expose"=>false,
  "singleEndpoint" => [
    "name" => "post",
    "args" => [
      "id" => [
        "type" => "String",
        "required" => true,
        "description" => "Post Id"
      ]
    ]
  ],
  "connector" => [
    "type" => "mySimpleDB",
      "configs" => [
        "file" => "posts.json"
      ]
    ]
  ]
~~~

Notice that we didn't expose the post model as we don't need to query a particular post. In our example Posts will only be requested thought Users.

## Create an Alambic instance

We can now merge connectors and models into one configuration array to configure an Alambic instance:

~~~php
<?php
$alambicConfig=[
  "alambicConnectors"=>$connectors,
  "alambicTypeDefs"=>[$userModel, $postModel]
]
$alambic = new Alambic($alambicConfig);
~~~

Our alambic server is almost complete, we just need to [create a  request endpoint](http://webtales.github.io/alambic/start/queries) to be able to request it.
